<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K线图</title>
  </head>
  <body>
    <canvas id="k-chart"></canvas>
    <script type="module">
      import { DrawCanvas } from "../utils/drawCanvas.js";
      import { yData, xData } from "./mock.js";
      const ctxStyle = {
        font: 14,
        fillStyle: "#666",
      };
      const drawCanvas = new DrawCanvas(
        {
          id: "#k-chart",
          width: 800,
          height: 700,
        },
        ctxStyle
      );
      const coordX = {
        x1: 40,
        y1: 680,
        x2: 760,
        y2: 680,
      };
      const coordY = {
        x1: 40,
        y1: 680,
        x2: 40,
        y2: 40,
      };
      function drawCoords() {
        //X
        drawCanvas.lineTo(coordX);
        //Y
        drawCanvas.lineTo(coordY);

        drawCoordsY(coordY.y2, coordY.y1);
      }
      function drawCoordsY(start, end) {
        const [max, min] = yData.reduce(
          ([max, min], cur) => {
            const _max = Math.max(...cur);
            const _min = Math.min(...cur);
            return [_max, _min];
          },
          [0, 0]
        );
        const residue = parseInt((max - min) / 4);
        const yList = [parseInt(min - residue)];
        const yCoords = [50];
        for (let i = 0; i <= 3; i++) {
          yList.push(yList[yList.length - 1] + residue);
        }
        for (let i = 1; i < 5; i++) {
          yCoords.push(parseInt(coordY.y1 / 4) * i);
        }
        yCoords.reverse();
        for (let i in yCoords) {
          drawCanvas.drawText({
            text: yList[i],
            x: coordX.x1 - 40,
            y: yCoords[i],
          });
        }
      }
      function drawCoordsX(xData) {
        const coordsLength = coordY.y1 - coordY.y2;
        const residue = parseInt(coordsLength / (xData.length - 1));
        const xCoords = [50];
        xData.slice(1).forEach((_, i) => {
          xCoords.push(xCoords[xCoords.length - 1] + residue);
        });
        console.log(xCoords);
        xData.forEach((number, i) => {
          drawCanvas.drawText({
            text: number,
            x: xCoords[i],
            y: coordY.y1 + 20,
          });
        });
      }
      drawCoordsX(xData);
      drawCoords();
    </script>
  </body>
</html>
