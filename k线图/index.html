<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K线图</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      #k-chart {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <canvas id="k-chart" width="800" height="700"></canvas>
    <script type="module">
      //TODO 计算坐标轴和坐标轴刻度悠问题
      import { DrawCanvas } from "../utils/drawCanvas.js";
      import { yData, xData } from "./mock.js";
      const ctxStyle = {
        font: 14,
        fillStyle: "#666",
      };
      const drawCanvas = new DrawCanvas(
        {
          id: "#k-chart",
          width: 800,
          height: 700,
        },
        ctxStyle
      );
      const startX = 50;
      const endX = 780;
      const startY = 20;
      const endY = 700;

      //绘制坐标系
      function drawAxis() {
        drawAxisLine();
        drawAxisY();
      }
      drawAxis();
      //绘制y轴
      function drawAxisY() {
        let max = Math.max(...[].concat(...yData));
        let min = Math.min(...[].concat(...yData));
        //计算y轴刻度最大值和最小值范围
        max = Math.floor(max + max / 5);
        min = Math.floor(min - min / 5);
        console.log(max, min);

        const yHeight = endY - startY;
        const interval = yHeight / max;
        const middleHeight = (max - min) / 3;
        let yAxisData = [max, min];
        for (let i = 2; i < 5; i++) {
          yAxisData.push(parseInt(middleHeight * i));
        }
        yAxisData = yAxisData.sort((a, b) => b - a);
        console.log(yAxisData);
      }
      //绘制坐标轴线条
      function drawAxisLine() {
        drawCanvas.lineTo({ x1: startX, y1: endY, x2: endX, y2: endY });
        drawCanvas.lineTo({ x1: startX, y1: endY, x2: startX, y2: 0 });
      }
    </script>
  </body>
</html>
